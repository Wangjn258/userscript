# BJTU 抢课脚本

**免责声明: 此脚本仅供学习交流使用, 请于下载后的 24 小时内删除, 禁止用于实际选课, 由使用此脚本造成的任何后果与开发者无关**

1. 为浏览器安装`Tampermonkey`脚本
2. 安装`userscript.user.js`
3. 在选课界面/脚本代码页面写入配置待选课程
4. 点击`开始抢课`, 等待弹出系统通知

**按下打开 F12 的控制台查看抢课日志**

## 🚀 使用说明

### 📌 匹配模式:

- 简单匹配
  - 支持匹配课程名, 支持泛选
  - 支持直接在选课界面设置, 课程名之间用英文逗号`,`分隔
- 高级匹配
  - 支持匹配表格内所有字段
  - 不支持在选课界面内设置, 请手动编辑脚本中的变量值

### 📌 简单匹配示例:

要匹配所有`人类的生育与健康 02`与`癌症知多少`

```js
matchName: ['人类的生育与健康 02', '癌症知多少']
```

### 📌 高级匹配示例:

> 高级匹配不支持在选课界面内设置, 请手动编辑脚本中的变量值

要匹配`A009018B:修身养性与大学生活 03`

```js
matchPattern: [{ cname: 'A009018B:修身养性与大学生活 03' }]
```

要匹配`晓明明`老师的`全校任选课`

```js
matchPattern: [{ tname: '晓明明', more: '全校任选课' }]
```

要匹配`晓红红`老师`第01-16周 星期二 第2节`的课

```js
matchPattern: [{ tname: '晓红红', tap: '第01-16周 星期二 第2节' }]
```

支持参数:

- `cname` (课程名)
- `credit` (学分)
- `type` (考试类型)
- `tname` (上课教师)
- `tap` (时间地点)
- `more` (选课限制说明)

## 💡 脚本原理

用`fetch()`请求纯净的`<table>`元素, 使用`tabletojson`库将其转为 json, 用`setinterval()`无刷新定时重新获取最新数据, 用`matchPattern()`匹配给定表达式, 一旦匹配成功触发`trialSubmit()`, 根据实际情况选择重新请求数据还是提交选课请求.

`simpleMatch()`本质上是构造了包含`cname`的对象数组并传入`advanceMatch()`.

## 😳 注意事项

读取参数优先级: `config值` > `界面输入(本地存储)`

使用参数优先级: `matchPattern` > `matchName`

## ✨ 后续计划

- 抛课与抢课的联动: 匹配到目标课程因已选同类课而无法选择时, 抛出已有的课程, 选择目标课程
